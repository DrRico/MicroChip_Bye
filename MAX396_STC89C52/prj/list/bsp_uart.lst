C51 COMPILER V9.57.0.0   BSP_UART                                                          06/16/2020 11:31:24 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE BSP_UART
OBJECT MODULE PLACED IN .\bsp_uart.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\src\bsp\bsp_uart.c COMPACT OPTIMIZE(8,SPEED) INCDIR(..\src\bsp) DEBUG
                    - OBJECTEXTEND PRINT(.\list\bsp_uart.lst) OBJECT(.\bsp_uart.obj)

line level    source

   1          /*
   2          *********************************************************************************************************
   3          *
   4          *       模块名称 : 串口驱动模块
   5          *       文件名称 : bsp_uart.c
   6          *       版    本 : V1.0
   7          *       说    明 : 配置UART工作模式
   8          *
   9          *       修改记录 :
  10          *               版本号  日期       作者    说明
  11          *               v1.0    2012-10-12 armfly  ST固件库版本 V2.1.0
  12          *
  13          *       Copyright (C), 2012-2013, 安富莱电子 www.armfly.com
  14          *
  15          *********************************************************************************************************
  16          */
  17          
  18          #include "bsp.h"
  19          
  20          void Uart_isr() interrupt 4      //中断接收程序
  21          {
  22   1              if(RI)                     //判断是否接收完，接收完成后，由硬件置RI位
  23   1              {
  24   2                      //Txd_data=SBUF;               //读入缓冲区
  25   2                      //=0;                      /RI/清标志
  26   2                      //Recdat=1;             //有数据，建立标志
  27   2              }
  28   1      }
  29          
  30          /*
  31          *********************************************************************************************************
  32          *       函 数 名: bsp_SendUart
  33          *       功能说明: 通过串口发送一个字节，等待发送完毕后才返回。
  34          *       形    参：_data ： 待发送的数据
  35          *       返 回 值: 无
  36          *********************************************************************************************************
  37          */
  38          void UART_SendByte(uint8_t _data)
  39          {
  40   1              SBUF = _data;   /* 发送数据送缓冲 */
  41   1              while(!TI);             /* 等待发送完成 */
  42   1              TI = 0;
  43   1      }
  44          
  45          /*
  46          *********************************************************************************************************
  47          *       函 数 名: UART_GetByte
  48          *       功能说明: 等待串口接收一个字节
  49          *       形    参：_data ： 待发送的数据
  50          *       返 回 值: 无
  51          *********************************************************************************************************
  52          */
  53          uint8_t UART_GetByte(void)
  54          {
C51 COMPILER V9.57.0.0   BSP_UART                                                          06/16/2020 11:31:24 PAGE 2   

  55   1              uint8_t c;
  56   1      
  57   1              while (RI == 0);
  58   1              c = SBUF;
  59   1              RI = 0; 
  60   1      
  61   1              return c;
  62   1      }
  63          
  64          /*
  65          *********************************************************************************************************
  66          *       函 数 名: UART_SendBuf
  67          *       功能说明: 通过串口发送一个字节，等待发送完毕后才返回。
  68          *       形    参：_pBuf : 待发送的数据缓冲区
  69          *                         _len : 数据长度
  70          *       返 回 值: 无
  71          *********************************************************************************************************
  72          */
  73          void UART_SendBuf(uint8_t *_pBuf, uint8_t _len)
  74          {
  75   1              while(_len--)
  76   1              {
  77   2                      UART_SendByte(*_pBuf++);
  78   2              }
  79   1      }
  80          
  81          /*
  82          *********************************************************************************************************
  83          *       函 数 名: bsp_InitUart
  84          *       功能说明: 初始化CPU的U串口硬件设备。未启用中断。
  85          *       形    参：无
  86          *       返 回 值: 无
  87          *********************************************************************************************************
  88          */
  89          void bsp_InitUart(void)
  90          {
  91   1              SCON = 0x50;    /* 010 1 0000B，工作方式1, 8位UART，波特率可变，允许接收 */
  92   1              TMOD = 0x20;    /* T1工作于方式2 */
  93   1              TCON = 0x40;    /* 定时器1开始计数 */
  94   1              TH1 = 250;              /* T1计数初值 */
  95   1              TL1 = 250;
  96   1              PCON = 0x80;    /* SMOD置1,双倍速率 */
  97   1              RI = 0;
  98   1              TI = 0;
  99   1      }
 100          
 101          /***************************** 安富莱电子 www.armfly.com (END OF FILE) *********************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     83    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----       3
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
